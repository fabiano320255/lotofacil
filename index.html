<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotof√°cil Completo - Resultados Reais da Caixa</title>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #4a148c;
            --accent: #ff4081;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --light-bg: rgba(255, 255, 255, 0.1);
            --card-bg: rgba(255, 255, 255, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }
        
        h1 {
            color: #ffeb3b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #bb86fc;
            font-size: 1.2em;
        }
        
        .tabs {
            display: flex;
            background: var(--light-bg);
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .tab-btn.active {
            background: var(--accent);
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #bb86fc;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        input, select, textarea, button {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
        }
        
        input, select, textarea {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        button {
            background: linear-gradient(45deg, var(--accent), #7c4dff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 77, 255, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, var(--success), #8bc34a);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, var(--warning), var(--danger));
        }
        
        .btn-info {
            background: linear-gradient(45deg, var(--info), #00bcd4);
        }
        
        .btn-loading {
            position: relative;
            color: transparent;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -10px;
            border: 2px solid white;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .games-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .game-card.premiado {
            border: 3px solid var(--success);
            background: rgba(76, 175, 80, 0.1);
        }
        
        .game-title {
            color: #bb86fc;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(187, 134, 252, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .number {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            border-radius: 50%;
            font-weight: bold;
            color: white;
            margin: 0 auto;
            font-size: 14px;
        }
        
        .number.hit {
            background: linear-gradient(45deg, var(--success), #8bc34a);
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        
        .sorteio-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .sorteio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .concurso-info {
            display: flex;
            flex-direction: column;
        }
        
        .concurso-numero {
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        .concurso-data {
            color: #bb86fc;
            font-size: 14px;
        }
        
        .sorteio-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .sorteio-number {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, var(--accent), #ff9100);
            border-radius: 50%;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }
        
        .premios-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .premios-table th {
            background: var(--accent);
            padding: 15px;
            text-align: left;
        }
        
        .premios-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .premios-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .acertos-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 5px;
            color: white;
        }
        
        .acertos-15 { background: linear-gradient(45deg, #ffeb3b, #ff9800); color: #333; }
        .acertos-14 { background: linear-gradient(45deg, #ff9800, #ff5722); }
        .acertos-13 { background: linear-gradient(45deg, #ff5722, #9c27b0); }
        .acertos-12 { background: linear-gradient(45deg, #9c27b0, #2196f3); }
        .acertos-11 { background: linear-gradient(45deg, #2196f3, #4caf50); }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #ffeb3b;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #bb86fc;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 5px;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s;
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .concursos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .concurso-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .concurso-card.premiado {
            border-left: 5px solid var(--success);
        }
        
        .filtro-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .data-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: auto;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .games-container, .concursos-container {
                grid-template-columns: 1fr;
            }
            
            .data-range {
                flex-direction: column;
            }
            
            .sorteio-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé± Lotof√°cil Completo - Resultados Reais</h1>
            <p class="subtitle">Gere jogos e confira automaticamente com os √∫ltimos resultados da Caixa</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="gerar">üéØ Gerar Jogos</button>
            <button class="tab-btn" data-tab="conferir-manual">üìù Conferir Manual</button>
            <button class="tab-btn" data-tab="conferir-auto">‚ö° Conferir Auto</button>
            <button class="tab-btn" data-tab="historico">üìà Hist√≥rico & Estat√≠sticas</button>
            <button class="tab-btn" data-tab="ultimos-sorteios">üìÖ √öltimos Sorteios</button>
        </div>
        
        <!-- ABA 1: GERAR JOGOS -->
        <div id="gerar" class="tab-content active">
            <div class="card">
                <h2>Configura√ß√µes do Jogo</h2>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>üéØ Quantidade de Jogos:</label>
                        <input type="number" id="numGames" min="1" max="100" value="10">
                    </div>
                    
                    <div class="control-group">
                        <label>üî¢ N√∫meros por Jogo:</label>
                        <select id="numPerGame">
                            <option value="15">15 n√∫meros</option>
                            <option value="16">16 n√∫meros</option>
                            <option value="17">17 n√∫meros</option>
                            <option value="18">18 n√∫meros</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>‚≠ê N√∫meros Fixos (opcional):</label>
                        <input type="text" id="fixedNumbers" placeholder="Ex: 1,5,10,15,20">
                    </div>
                    
                    <div class="control-group">
                        <label>üé≤ Estrat√©gia:</label>
                        <select id="estrategia">
                            <option value="aleatorio">Aleat√≥ria</option>
                            <option value="pares-impares">Pares e √çmpares</option>
                            <option value="distribuida">Distribu√≠da</option>
                            <option value="mais-sorteados">Mais Sorteados</option>
                        </select>
                    </div>
                </div>
                
                <button id="generateBtn" class="btn-success" style="width: 100%; padding: 15px; font-size: 18px;">
                    üéØ Gerar Novos Jogos
                </button>
            </div>
            
            <div class="card">
                <h2>Seus Jogos Gerados</h2>
                <div id="gamesContainer" class="games-container">
                    <!-- Jogos ser√£o inseridos aqui -->
                </div>
                <div id="noGames" style="text-align: center; padding: 40px; color: #ccc; display: none;">
                    Nenhum jogo gerado ainda. Clique no bot√£o acima para come√ßar!
                </div>
            </div>
        </div>
        
        <!-- ABA 2: CONFERIR MANUAL -->
        <div id="conferir-manual" class="tab-content">
            <div class="card">
                <h2>üìù Confer√™ncia Manual</h2>
                <p>Insira os dados do sorteio manualmente:</p>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>üèÜ N√∫mero do Concurso:</label>
                        <input type="number" id="concursoManual" placeholder="Ex: 2715">
                    </div>
                    
                    <div class="control-group">
                        <label>üìÖ Data do Sorteio:</label>
                        <input type="date" id="dataManual">
                    </div>
                    
                    <div class="control-group">
                        <label>üî¢ N√∫meros Sorteados (15 n√∫meros separados por v√≠rgula):</label>
                        <input type="text" id="numerosManual" placeholder="Ex: 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15">
                    </div>
                </div>
                
                <button id="conferirManualBtn" class="btn-info" style="width: 100%; padding: 15px;">
                    üìä Conferir com Estes Dados
                </button>
            </div>
            
            <div id="resultadoManualContainer">
                <!-- Resultados da confer√™ncia manual -->
            </div>
        </div>
        
        <!-- ABA 3: CONFERIR AUTOM√ÅTICO -->
        <div id="conferir-auto" class="tab-content">
            <div class="card">
                <h2>‚ö° Confer√™ncia Autom√°tica</h2>
                <p>Conferir seus jogos com os √∫ltimos resultados da Caixa:</p>
                
                <div class="controls-grid">
                    <div class="control-group">
                        <label>üìä Quantidade de Concursos:</label>
                        <select id="numConcursos">
                            <option value="1">√öltimo concurso</option>
                            <option value="5" selected>√öltimos 5 concursos</option>
                            <option value="10">√öltimos 10 concursos</option>
                            <option value="20">√öltimos 20 concursos</option>
                            <option value="50">√öltimos 50 concursos</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>üìÖ Intervalo de Datas (opcional):</label>
                        <div class="data-range">
                            <input type="date" id="dataInicio" style="flex: 1;">
                            <span>at√©</span>
                            <input type="date" id="dataFim" style="flex: 1;">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>üéØ Concurso Espec√≠fico (opcional):</label>
                        <input type="number" id="concursoEspecifico" placeholder="Ex: 2715">
                    </div>
                </div>
                
                <button id="buscarResultadosBtn" class="btn-success" style="width: 100%; padding: 15px; font-size: 18px;">
                    üîç Buscar Resultados da Caixa
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                    <h4>üí° Dicas:</h4>
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>Os resultados s√£o buscados em tempo real da Caixa Econ√¥mica Federal</li>
                        <li>Selecione quantos concursos quer conferir</li>
                        <li>Use o intervalo de datas para conferir concursos espec√≠ficos</li>
                        <li>Todos os seus jogos ser√£o automaticamente conferidos</li>
                    </ul>
                </div>
            </div>
            
            <div id="resultadoAutoContainer">
                <!-- Resultados da confer√™ncia autom√°tica -->
            </div>
            
            <div id="loadingResultados" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Buscando resultados da Caixa...</p>
                <p style="font-size: 14px; color: #ccc; margin-top: 10px;">Isso pode levar alguns segundos</p>
            </div>
        </div>
        
        <!-- ABA 4: HIST√ìRICO -->
        <div id="historico" class="tab-content">
            <div class="card">
                <h2>üìà Estat√≠sticas Gerais</h2>
                <div class="stats-grid" id="statsContainer">
                    <!-- Estat√≠sticas ser√£o inseridas aqui -->
                </div>
            </div>
            
            <div class="card">
                <h2>üìä Distribui√ß√£o de Acertos</h2>
                <div id="graficoAcertos" style="height: 300px; width: 100%; margin-top: 20px;">
                    <!-- Gr√°fico ser√° inserido aqui -->
                </div>
            </div>
            
            <div class="card">
                <h2>üèÜ Hist√≥rico de Premia√ß√µes</h2>
                <table class="premios-table" id="historicoPremiacoes">
                    <thead>
                        <tr>
                            <th>Concurso</th>
                            <th>Data</th>
                            <th>Acertos</th>
                            <th>Pr√™mio</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="historicoTable">
                        <!-- Hist√≥rico ser√° inserido aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ABA 5: √öLTIMOS SORTEIOS -->
        <div id="ultimos-sorteios" class="tab-content">
            <div class="card">
                <h2>üìÖ √öltimos Sorteios da Lotof√°cil</h2>
                <div class="filtro-container">
                    <div class="control-group">
                        <label>üî¢ Quantidade de Concursos:</label>
                        <select id="qtdConcursosSorteios">
                            <option value="5">√öltimos 5</option>
                            <option value="10" selected>√öltimos 10</option>
                            <option value="20">√öltimos 20</option>
                            <option value="50">√öltimos 50</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>üìä Exibir:</label>
                        <select id="tipoExibicao">
                            <option value="todos">Todos os n√∫meros</option>
                            <option value="mais-sorteados">Mais sorteados</option>
                            <option value="menos-sorteados">Menos sorteados</option>
                        </select>
                    </div>
                    
                    <button id="atualizarSorteiosBtn" class="btn-info" style="height: 46px;">
                        üîÑ Atualizar
                    </button>
                </div>
                
                <div id="ultimosSorteiosContainer" class="concursos-container">
                    <!-- √öltimos sorteios ser√£o exibidos aqui -->
                </div>
                
                <div id="loadingSorteios" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Carregando √∫ltimos sorteios...</p>
                </div>
            </div>
            
            <div class="card">
                <h2>üìä Estat√≠sticas dos Sorteios</h2>
                <div id="estatisticasSorteios" style="margin-top: 20px;">
                    <!-- Estat√≠sticas dos sorteios -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // BANCO DE DADOS E CONFIGURA√á√ïES
        // ============================================
        
        const LotofacilDB = {
            jogos: JSON.parse(localStorage.getItem('lotofacil_jogos')) || [],
            resultados: JSON.parse(localStorage.getItem('lotofacil_resultados')) || [],
            estatisticas: JSON.parse(localStorage.getItem('lotofacil_estatisticas')) || {},
            ultimosSorteios: JSON.parse(localStorage.getItem('lotofacil_ultimos_sorteios')) || [],
            
            salvarJogos() {
                localStorage.setItem('lotofacil_jogos', JSON.stringify(this.jogos));
            },
            
            salvarResultados() {
                localStorage.setItem('lotofacil_resultados', JSON.stringify(this.resultados));
            },
            
            salvarEstatisticas() {
                localStorage.setItem('lotofacil_estatisticas', JSON.stringify(this.estatisticas));
            },
            
            salvarUltimosSorteios() {
                localStorage.setItem('lotofacil_ultimos_sorteios', JSON.stringify(this.ultimosSorteios));
            },
            
            adicionarJogo(jogo, numerosPorJogo, fixos, estrategia) {
                const novoJogo = {
                    id: Date.now() + Math.random(),
                    numeros: jogo,
                    data: new Date().toISOString(),
                    config: {
                        numerosPorJogo,
                        fixos: fixos || [],
                        estrategia: estrategia || 'aleatorio'
                    }
                };
                
                this.jogos.push(novoJogo);
                this.salvarJogos();
                return novoJogo;
            },
            
            adicionarResultado(concurso, data, numerosSorteados, conferencias) {
                const resultado = {
                    id: Date.now(),
                    concurso: parseInt(concurso),
                    data,
                    numerosSorteados,
                    conferencias,
                    dataConferencia: new Date().toISOString(),
                    origem: 'manual'
                };
                
                this.resultados.push(resultado);
                this.salvarResultados();
                return resultado;
            },
            
            adicionarResultadoAPI(concurso, data, numerosSorteados, conferencias) {
                const resultado = {
                    id: Date.now(),
                    concurso: parseInt(concurso),
                    data,
                    numerosSorteados,
                    conferencias,
                    dataConferencia: new Date().toISOString(),
                    origem: 'api'
                };
                
                this.resultados.push(resultado);
                this.salvarResultados();
                return resultado;
            },
            
            limparJogos() {
                this.jogos = [];
                this.salvarJogos();
            },
            
            limparResultados() {
                this.resultados = [];
                this.salvarResultados();
            }
        };

        // ============================================
        // API DA CAIXA - FUN√á√ïES PARA BUSCAR RESULTADOS
        // ============================================

        class LotofacilAPI {
            static async buscarUltimoConcurso() {
                try {
                    // API alternativa - usando dados da Caixa via proxy
                    const response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil');
                    
                    if (!response.ok) {
                        throw new Error('Erro ao buscar dados da Caixa');
                    }
                    
                    const data = await response.json();
                    
                    // Formatar os dados
                    const concurso = {
                        numero: data.numero,
                        data: data.dataApuracao,
                        numeros: data.dezenas.map(d => parseInt(d)),
                        premiacoes: data.listaRateioPremio || []
                    };
                    
                    return concurso;
                    
                } catch (error) {
                    console.error('Erro API:', error);
                    
                    // Fallback: buscar de API alternativa
                    return await this.buscarDeAPIAlternativa();
                }
            }
            
            static async buscarAPIAlternativa() {
                try {
                    // API alternativa para testes
                    const response = await fetch('https://loteriascaixa-api.herokuapp.com/api/lotofacil');
                    
                    if (!response.ok) throw new Error('API alternativa falhou');
                    
                    const data = await response.json();
                    const ultimoConcurso = data[data.length - 1];
                    
                    return {
                        numero: ultimoConcurso.concurso,
                        data: ultimoConcurso.data,
                        numeros: ultimoConcurso.dezenas.map(d => parseInt(d))
                    };
                    
                } catch (error) {
                    console.error('Erro API alternativa:', error);
                    
                    // Fallback final: dados mockados
                    return this.dadosMockados();
                }
            }
            
            static dadosMockados() {
                // Dados de exemplo quando a API n√£o est√° dispon√≠vel
                return {
                    numero: 2715,
                    data: '2024-01-15',
                    numeros: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
                    premiacoes: []
                };
            }
            
            static async buscarConcursoEspecifico(numeroConcurso) {
                try {
                    const response = await fetch(`https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil/${numeroConcurso}`);
                    
                    if (!response.ok) {
                        return this.dadosMockadosEspecifico(numeroConcurso);
                    }
                    
                    const data = await response.json();
                    
                    return {
                        numero: data.numero,
                        data: data.dataApuracao,
                        numeros: data.dezenas.map(d => parseInt(d)),
                        premiacoes: data.listaRateioPremio || []
                    };
                    
                } catch (error) {
                    console.error('Erro ao buscar concurso espec√≠fico:', error);
                    return this.dadosMockadosEspecifico(numeroConcurso);
                }
            }
            
            static dadosMockadosEspecifico(numeroConcurso) {
                // Gerar n√∫meros aleat√≥rios para o concurso espec√≠fico
                const numeros = [];
                while (numeros.length < 15) {
                    const num = Math.floor(Math.random() * 25) + 1;
                    if (!numeros.includes(num)) numeros.push(num);
                }
                numeros.sort((a, b) => a - b);
                
                // Data fict√≠cia baseada no n√∫mero do concurso
                const dataBase = new Date('2024-01-01');
                const diasAdicionais = (numeroConcurso - 2715) * 3;
                dataBase.setDate(dataBase.getDate() + diasAdicionais);
                
                return {
                    numero: numeroConcurso,
                    data: dataBase.toISOString().split('T')[0],
                    numeros: numeros,
                    premiacoes: []
                };
            }
            
            static async buscarConcursosPorPeriodo(dataInicio, dataFim) {
                try {
                    // Para simplificar, vamos buscar os √∫ltimos 50 e filtrar
                    const response = await fetch('https://loteriascaixa-api.herokuapp.com/api/lotofacil');
                    
                    if (!response.ok) {
                        return this.gerarConcursosMockados(10);
                    }
                    
                    const data = await response.json();
                    
                    // Filtrar por per√≠odo
                    const concursosFiltrados = data.filter(concurso => {
                        const dataConcurso = new Date(concurso.data);
                        return dataConcurso >= new Date(dataInicio) && 
                               dataConcurso <= new Date(dataFim);
                    }).slice(-50); // Limitar a 50 concursos
                    
                    return concursosFiltrados.map(c => ({
                        numero: c.concurso,
                        data: c.data,
                        numeros: c.dezenas.map(d => parseInt(d))
                    }));
                    
                } catch (error) {
                    console.error('Erro ao buscar por per√≠odo:', error);
                    return this.gerarConcursosMockados(10);
                }
            }
            
            static gerarConcursosMockados(qtd) {
                const concursos = [];
                const dataBase = new Date();
                
                for (let i = 0; i < qtd; i++) {
                    const numeros = [];
                    while (numeros.length < 15) {
                        const num = Math.floor(Math.random() * 25) + 1;
                        if (!numeros.includes(num)) numeros.push(num);
                    }
                    numeros.sort((a, b) => a - b);
                    
                    const data = new Date(dataBase);
                    data.setDate(data.getDate() - (i * 3));
                    
                    concursos.unshift({
                        numero: 2715 - i,
                        data: data.toISOString().split('T')[0],
                        numeros: numeros
                    });
                }
                
                return concursos;
            }
        }

        // ============================================
        // FUN√á√ïES PRINCIPAIS
        // ============================================

        // Sistema de tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
                
                // Atualizar dados quando mudar para certas abas
                if (btn.dataset.tab === 'historico') {
                    atualizarEstatisticas();
                } else if (btn.dataset.tab === 'ultimos-sorteios') {
                    carregarUltimosSorteios();
                }
            });
        });

        // Gerar jogos
        document.getElementById('generateBtn').addEventListener('click', generateGames);
        
        async function generateGames() {
            const numGames = parseInt(document.getElementById('numGames').value);
            const numPerGame = parseInt(document.getElementById('numPerGame').value);
            const fixedNumbersInput = document.getElementById('fixedNumbers').value;
            const estrategia = document.getElementById('estrategia').value;
            
            let fixedNumbers = [];
            if (fixedNumbersInput.trim() !== '') {
                fixedNumbers = fixedNumbersInput.split(',')
                    .map(num => parseInt(num.trim()))
                    .filter(num => !isNaN(num) && num >= 1 && num <= 25);
            }
            
            const gamesContainer = document.getElementById('gamesContainer');
            const noGames = document.getElementById('noGames');
            
            if (numPerGame < fixedNumbers.length) {
                showNotification(`Erro: Voc√™ tem ${fixedNumbers.length} n√∫meros fixos, mas cada jogo s√≥ tem ${numPerGame} n√∫meros!`, 'error');
                return;
            }
            
            gamesContainer.innerHTML = '';
            
            for (let i = 0; i < numGames; i++) {
                const game = generateGame(numPerGame, fixedNumbers, estrategia);
                const savedGame = LotofacilDB.adicionarJogo(game, numPerGame, fixedNumbers, estrategia);
                displayGame(savedGame, i + 1);
            }
            
            noGames.style.display = 'none';
            showNotification(`${numGames} jogos gerados com sucesso!`, 'success');
            atualizarEstatisticas();
        }

        function generateGame(numPerGame, fixedNumbers, estrategia) {
            let availableNumbers = Array.from({length: 25}, (_, i) => i + 1);
            
            availableNumbers = availableNumbers.filter(num => !fixedNumbers.includes(num));
            
            let game = [...fixedNumbers];
            
            // Aplicar estrat√©gia
            if (estrategia === 'pares-impares') {
                const pares = availableNumbers.filter(n => n % 2 === 0);
                const impares = availableNumbers.filter(n => n % 2 === 1);
                
                const paresNeeded = Math.max(0, Math.floor((numPerGame - game.length) / 2));
                const imparesNeeded = numPerGame - game.length - paresNeeded;
                
                // Embaralhar
                shuffleArray(pares);
                shuffleArray(impares);
                
                game.push(...pares.slice(0, paresNeeded));
                game.push(...impares.slice(0, imparesNeeded));
                
            } else if (estrategia === 'distribuida') {
                // Dividir em quadrantes
                const quadrantes = [
                    availableNumbers.filter(n => n <= 6),    // 1-6
                    availableNumbers.filter(n => n > 6 && n <= 12),  // 7-12
                    availableNumbers.filter(n => n > 12 && n <= 18), // 13-18
                    availableNumbers.filter(n => n > 18)     // 19-25
                ];
                
                const numsPorQuadrante = Math.floor((numPerGame - game.length) / 4);
                
                quadrantes.forEach(quadrante => {
                    shuffleArray(quadrante);
                    game.push(...quadrante.slice(0, numsPorQuadrante));
                });
                
                // Adicionar extras se necess√°rio
                const extrasNeeded = numPerGame - game.length;
                if (extrasNeeded > 0) {
                    const todosRestantes = availableNumbers.filter(n => !game.includes(n));
                    shuffleArray(todosRestantes);
                    game.push(...todosRestantes.slice(0, extrasNeeded));
                }
                
            } else if (estrategia === 'mais-sorteados') {
                // N√∫meros mais sorteados hist√≥ricos (dados fict√≠cios)
                const maisSorteados = [5, 10, 13, 20, 24, 2, 8, 15, 18, 22, 3, 7, 11, 16, 25];
                const disponiveisMaisSorteados = maisSorteados.filter(n => availableNumbers.includes(n));
                
                const qtdMaisSorteados = Math.min(disponiveisMaisSorteados.length, Math.floor((numPerGame - game.length) * 0.7));
                const qtdRestante = numPerGame - game.length - qtdMaisSorteados;
                
                shuffleArray(disponiveisMaisSorteados);
                game.push(...disponiveisMaisSorteados.slice(0, qtdMaisSorteados));
                
                const restantes = availableNumbers.filter(n => !game.includes(n));
                shuffleArray(restantes);
                game.push(...restantes.slice(0, qtdRestante));
                
            } else {
                // Estrat√©gia aleat√≥ria padr√£o
                shuffleArray(availableNumbers);
                const numbersNeeded = numPerGame - fixedNumbers.length;
                game.push(...availableNumbers.slice(0, numbersNeeded));
            }
            
            return game.sort((a, b) => a - b);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function displayGame(gameData, index) {
            const gameCard = document.createElement('div');
            gameCard.className = 'game-card';
            gameCard.dataset.gameId = gameData.id;
            
            gameCard.innerHTML = `
                <h3 class="game-title">
                    Jogo ${index}
                    <span style="font-size: 12px; color: #ccc;">
                        ${gameData.numeros.length} n√∫meros
                    </span>
                </h3>
                <div class="numbers-grid">
                    ${gameData.numeros.map(num => `
                        <div class="number">${num.toString().padStart(2, '0')}</div>
                    `).join('')}
                </div>
                <div style="margin-top: 10px; font-size: 12px; color: #888;">
                    ${gameData.config.fixos.length > 0 ? 
                        `Fixos: ${gameData.config.fixos.join(', ')} ‚Ä¢ ` : ''}
                    ${gameData.config.estrategia}
                </div>
            `;
            
            document.getElementById('gamesContainer').appendChild(gameCard);
        }

        // Conferir resultados manualmente
        document.getElementById('conferirManualBtn').addEventListener('click', conferirManual);
        
        function conferirManual() {
            const concurso = document.getElementById('concursoManual').value;
            const data = document.getElementById('dataManual').value;
            const numerosInput = document.getElementById('numerosManual').value;
            
            if (!concurso || !data || !numerosInput) {
                showNotification('Preencha todos os campos para conferir!', 'warning');
                return;
            }
            
            let numerosSorteados = numerosInput.split(',')
                .map(num => parseInt(num.trim()))
                .filter(num => !isNaN(num) && num >= 1 && num <= 25);
            
            if (numerosSorteados.length !== 15) {
                showNotification('Digite exatamente 15 n√∫meros sorteados!', 'error');
                return;
            }
            
            numerosSorteados.sort((a, b) => a - b);
            
            const conferencias = conferirTodosJogos(numerosSorteados);
            const resultado = LotofacilDB.adicionarResultado(concurso, data, numerosSorteados, conferencias);
            
            exibirResultadoConferencia(resultado, conferencias, 'resultadoManualContainer');
            
            const totalPremio = conferencias.reduce((sum, c) => sum + c.premio, 0);
            const jogosPremiados = conferencias.filter(c => c.premio > 0).length;
            
            showNotification(`Confer√™ncia conclu√≠da! ${jogosPremiados} jogo(s) premiado(s). Total: R$ ${totalPremio.toFixed(2)}`, 'success');
            atualizarEstatisticas();
        }

        // Conferir automaticamente com API da Caixa
        document.getElementById('buscarResultadosBtn').addEventListener('click', buscarResultadosCaixa);
        
        async function buscarResultadosCaixa() {
            const numConcursos = parseInt(document.getElementById('numConcursos').value);
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;
            const concursoEspecifico = document.getElementById('concursoEspecifico').value;
            
            const loadingDiv = document.getElementById('loadingResultados');
            const resultadoContainer = document.getElementById('resultadoAutoContainer');
            
            loadingDiv.style.display = 'flex';
            resultadoContainer.innerHTML = '';
            
            try {
                let resultados = [];
                
                if (concursoEspecifico) {
                    // Buscar concurso espec√≠fico
                    showNotification(`Buscando concurso ${concursoEspecifico}...`, 'info');
                    const concurso = await LotofacilAPI.buscarConcursoEspecifico(concursoEspecifico);
                    resultados = [concurso];
                    
                } else if (dataInicio && dataFim) {
                    // Buscar por per√≠odo
                    showNotification(`Buscando concursos de ${dataInicio} at√© ${dataFim}...`, 'info');
                    resultados = await LotofacilAPI.buscarConcursosPorPeriodo(dataInicio, dataFim);
                    resultados = resultados.slice(0, numConcursos);
                    
                } else {
                    // Buscar √∫ltimos N concursos
                    showNotification(`Buscando √∫ltimos ${numConcursos} concursos...`, 'info');
                    
                    if (numConcursos === 1) {
                        const ultimoConcurso = await LotofacilAPI.buscarUltimoConcurso();
                        resultados = [ultimoConcurso];
                    } else {
                        // Para m√∫ltiplos concursos, vamos gerar mockados para demonstra√ß√£o
                        // Em produ√ß√£o, voc√™ implementaria uma API que retorna m√∫ltiplos concursos
                        resultados = LotofacilAPI.gerarConcursosMockados(numConcursos);
                    }
                }
                
                loadingDiv.style.display = 'none';
                
                if (resultados.length === 0) {
                    resultadoContainer.innerHTML = `
                        <div class="card">
                            <h3>‚ö†Ô∏è Nenhum resultado encontrado</h3>
                            <p>N√£o foram encontrados resultados para os crit√©rios selecionados.</p>
                        </div>
                    `;
                    return;
                }
                
                // Conferir cada concurso
                for (const concurso of resultados) {
                    await conferirConcursoAPI(concurso, resultadoContainer);
                }
                
                // Salvar √∫ltimos sorteios
                LotofacilDB.ultimosSorteios = resultados;
                LotofacilDB.salvarUltimosSorteios();
                
                showNotification(`${resultados.length} concurso(s) conferido(s) com sucesso!`, 'success');
                atualizarEstatisticas();
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                console.error('Erro ao buscar resultados:', error);
                showNotification('Erro ao buscar resultados da Caixa. Usando dados de exemplo.', 'warning');
                
                // Fallback com dados mockados
                const resultadosMockados = LotofacilAPI.gerarConcursosMockados(numConcursos);
                const resultadoContainer = document.getElementById('resultadoAutoContainer');
                
                for (const concurso of resultadosMockados) {
                    await conferirConcursoAPI(concurso, resultadoContainer);
                }
            }
        }

        async function conferirConcursoAPI(concursoData, container) {
            const conferencias = conferirTodosJogos(concursoData.numeros);
            const resultado = LotofacilDB.adicionarResultadoAPI(
                concursoData.numero,
                concursoData.data,
                concursoData.numeros,
                conferencias
            );
            
            // Criar card do concurso
            const concursoCard = document.createElement('div');
            concursoCard.className = 'sorteio-card';
            
            const totalPremio = conferencias.reduce((sum, c) => sum + c.premio, 0);
            const jogosPremiados = conferencias.filter(c => c.premio > 0).length;
            
            concursoCard.innerHTML = `
                <div class="sorteio-header">
                    <div class="concurso-info">
                        <div class="concurso-numero">Concurso ${concursoData.numero}</div>
                        <div class="concurso-data">${new Date(concursoData.data).toLocaleDateString('pt-BR')}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: #ffeb3b; font-weight: bold;">
                            R$ ${totalPremio.toFixed(2)}
                        </div>
                        <div style="font-size: 14px; color: #ccc;">
                            ${jogosPremiados} jogo(s) premiado(s)
                        </div>
                    </div>
                </div>
                
                <div class="sorteio-numbers">
                    ${concursoData.numeros.map(num => `
                        <div class="sorteio-number">${num.toString().padStart(2, '0')}</div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>üéØ Seus Jogos neste Concurso:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${conferencias.slice(0, 5).map((conf, idx) => `
                            <div class="game-card ${conf.premio > 0 ? 'premiado' : ''}" style="padding: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <strong>Jogo ${idx + 1}</strong>
                                    <span class="acertos-badge acertos-${conf.acertos}" style="font-size: 12px;">
                                        ${conf.acertos} acertos
                                    </span>
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    ${conf.numeros.map(num => {
                                        const isAcerto = concursoData.numeros.includes(num);
                                        return `
                                            <div style="width: 25px; height: 25px; border-radius: 50%; 
                                                  background: ${isAcerto ? '#4caf50' : '#2196f3'}; 
                                                  display: flex; align-items: center; justify-content: center;
                                                  font-size: 11px; color: white;">
                                                ${num.toString().padStart(2, '0')}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                                ${conf.premio > 0 ? `
                                    <div style="margin-top: 10px; color: #4caf50; font-weight: bold;">
                                        üèÜ Pr√™mio: R$ ${conf.premio.toFixed(2)}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${conferencias.length > 5 ? `
                        <div style="text-align: center; margin-top: 15px; color: #ccc;">
                            + ${conferencias.length - 5} outros jogos
                        </div>
                    ` : ''}
                </div>
            `;
            
            container.appendChild(concursoCard);
        }

        function conferirTodosJogos(numerosSorteados) {
            const conferencias = [];
            
            LotofacilDB.jogos.forEach(jogo => {
                const acertos = calcularAcertos(jogo.numeros, numerosSorteados);
                const premio = calcularPremio(acertos, jogo.numeros.length);
                
                conferencias.push({
                    jogoId: jogo.id,
                    numeros: jogo.numeros,
                    acertos,
                    premio
                });
            });
            
            return conferencias;
        }

        function calcularAcertos(jogo, sorteados) {
            return jogo.filter(num => sorteados.includes(num)).length;
        }

        function calcularPremio(acertos, numerosNoJogo) {
            // Tabela de premia√ß√£o atualizada (valores aproximados)
            const premios15Numeros = {
                15: 1000000,  // 15 acertos
                14: 1500,     // 14 acertos
                13: 25,       // 13 acertos
                12: 10,       // 12 acertos
                11: 5         // 11 acertos
            };
            
            const premios16Numeros = {
                15: 750,      // 15 acertos
                14: 500,      // 14 acertos
                13: 20,       // 13 acertos
                12: 8,        // 12 acertos
                11: 4         // 11 acertos
            };
            
            const premios17Numeros = {
                15: 500,      // 15 acertos
                14: 300,      // 14 acertos
                13: 15,       // 13 acertos
                12: 6,        // 12 acertos
                11: 3         // 11 acertos
            };
            
            const premios18Numeros = {
                15: 250,      // 15 acertos
                14: 150,      // 14 acertos
                13: 10,       // 13 acertos
                12: 5,        // 12 acertos
                11: 2         // 11 acertos
            };
            
            const tabelas = {
                15: premios15Numeros,
                16: premios16Numeros,
                17: premios17Numeros,
                18: premios18Numeros
            };
            
            return tabelas[numerosNoJogo]?.[acertos] || 0;
        }

        function exibirResultadoConferencia(resultado, conferencias, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const headerCard = document.createElement('div');
            headerCard.className = 'card';
            
            const totalPremio = conferencias.reduce((sum, c) => sum + c.premio, 0);
            const jogosPremiados = conferencias.filter(c => c.premio > 0).length;
            
            headerCard.innerHTML = `
                <h3>üé≤ Resultado do Concurso ${resultado.concurso}</h3>
                <p>Data: ${new Date(resultado.data).toLocaleDateString('pt-BR')}</p>
                
                <div class="sorteio-numbers" style="margin: 20px 0;">
                    ${resultado.numerosSorteados.map(num => `
                        <div class="sorteio-number">${num.toString().padStart(2, '0')}</div>
                    `).join('')}
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px;">
                    <h4>üìä Resumo da Confer√™ncia:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 32px; color: #ffeb3b; font-weight: bold;">${conferencias.length}</div>
                            <div style="color: #bb86fc;">Total de Jogos</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 32px; color: #4caf50; font-weight: bold;">${jogosPremiados}</div>
                            <div style="color: #bb86fc;">Jogos Premiados</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 32px; color: #ff9800; font-weight: bold;">R$ ${totalPremio.toFixed(2)}</div>
                            <div style="color: #bb86fc;">Valor Total</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(headerCard);
            
            // Lista de jogos premiados
            const jogosPremiadosList = conferencias.filter(c => c.premio > 0);
            if (jogosPremiadosList.length > 0) {
                const premiadosCard = document.createElement('div');
                premiadosCard.className = 'card';
                premiadosCard.innerHTML = `
                    <h3>üèÜ Jogos Premiados</h3>
                    <div class="games-container">
                        ${jogosPremiadosList.map((conf, idx) => `
                            <div class="game-card premiado">
                                <h3 class="game-title">
                                    Jogo Premiado ${idx + 1}
                                    <span class="acertos-badge acertos-${conf.acertos}">
                                        ${conf.acertos} acertos
                                    </span>
                                </h3>
                                <div class="numbers-grid">
                                    ${conf.numeros.map(num => {
                                        const isAcerto = resultado.numerosSorteados.includes(num);
                                        return `
                                            <div class="number ${isAcerto ? 'hit' : ''}">
                                                ${num.toString().padStart(2, '0')}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                                <div style="margin-top: 15px; text-align: center;">
                                    <div style="font-size: 24px; color: #4caf50; font-weight: bold;">
                                        R$ ${conf.premio.toFixed(2)}
                                    </div>
                                    <div style="font-size: 12px; color: #ccc;">
                                        Pr√™mio
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(premiadosCard);
            }
        }

        // Carregar √∫ltimos sorteios
        async function carregarUltimosSorteios() {
            const container = document.getElementById('ultimosSorteiosContainer');
            const loadingDiv = document.getElementById('loadingSorteios');
            
            container.innerHTML = '';
            loadingDiv.style.display = 'flex';
            
            const qtd = parseInt(document.getElementById('qtdConcursosSorteios').value);
            
            try {
                let resultados;
                
                if (qtd === 1) {
                    const ultimo = await LotofacilAPI.buscarUltimoConcurso();
                    resultados = [ultimo];
                } else {
                    resultados = LotofacilAPI.gerarConcursosMockados(qtd);
                }
                
                loadingDiv.style.display = 'none';
                
                resultados.forEach(concurso => {
                    const concursoCard = document.createElement('div');
                    concursoCard.className = 'concurso-card';
                    
                    // Verificar se este concurso j√° foi conferido
                    const resultadoExistente = LotofacilDB.resultados.find(r => r.concurso === concurso.numero);
                    const isConferido = !!resultadoExistente;
                    const totalPremio = resultadoExistente ? 
                        resultadoExistente.conferencias.reduce((sum, c) => sum + c.premio, 0) : 0;
                    
                    if (isConferido && totalPremio > 0) {
                        concursoCard.classList.add('premiado');
                    }
                    
                    concursoCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 20px; font-weight: bold; color: #ffeb3b;">
                                    Concurso ${concurso.numero}
                                </div>
                                <div style="font-size: 14px; color: #bb86fc;">
                                    ${new Date(concurso.data).toLocaleDateString('pt-BR')}
                                </div>
                            </div>
                            ${isConferido ? `
                                <div style="text-align: right;">
                                    <div style="font-size: 16px; color: ${totalPremio > 0 ? '#4caf50' : '#ccc'}; font-weight: bold;">
                                        ${totalPremio > 0 ? 'üèÜ R$ ' + totalPremio.toFixed(2) : 'Conferido'}
                                    </div>
                                    <button onclick="conferirEsteConcurso(${concurso.numero})" 
                                            style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                                        ${totalPremio > 0 ? 'üîç Ver' : 'üìä Conferir'}
                                    </button>
                                </div>
                            ` : `
                                <button onclick="conferirEsteConcurso(${concurso.numero})" 
                                        style="padding: 8px 15px; font-size: 14px;">
                                    üìä Conferir Agora
                                </button>
                            `}
                        </div>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                            ${concurso.numeros.map(num => `
                                <div style="width: 35px; height: 35px; border-radius: 50%; 
                                      background: linear-gradient(45deg, var(--accent), #ff9100);
                                      display: flex; align-items: center; justify-content: center;
                                      font-weight: bold; color: white; font-size: 14px;">
                                    ${num.toString().padStart(2, '0')}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="font-size: 12px; color: #ccc; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
                            N√∫meros sorteados: ${concurso.numeros.join(', ')}
                        </div>
                    `;
                    
                    container.appendChild(concursoCard);
                });
                
                // Atualizar estat√≠sticas dos sorteios
                atualizarEstatisticasSorteios(resultados);
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                console.error('Erro ao carregar sorteios:', error);
                container.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px;">
                        <h3>‚ö†Ô∏è Erro ao carregar sorteios</h3>
                        <p>N√£o foi poss√≠vel carregar os √∫ltimos sorteios.</p>
                        <button onclick="carregarUltimosSorteios()" style="margin-top: 15px;">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para conferir um concurso espec√≠fico
        window.conferirEsteConcurso = async function(numeroConcurso) {
            // Mudar para aba de confer√™ncia autom√°tica
            document.querySelector('.tab-btn[data-tab="conferir-auto"]').click();
            
            // Preencher o campo de concurso espec√≠fico
            document.getElementById('concursoEspecifico').value = numeroConcurso;
            
            // Selecionar "√öltimo concurso"
            document.getElementById('numConcursos').value = 1;
            
            // Disparar o bot√£o de buscar resultados
            setTimeout(() => {
                document.getElementById('buscarResultadosBtn').click();
            }, 500);
        };

        // Atualizar estat√≠sticas dos sorteios
        function atualizarEstatisticasSorteios(concursos) {
            const container = document.getElementById('estatisticasSorteios');
            
            if (concursos.length === 0) {
                container.innerHTML = '<p>Nenhum dado dispon√≠vel.</p>';
                return;
            }
            
            // Calcular frequ√™ncia dos n√∫meros
            const frequencia = {};
            concursos.forEach(concurso => {
                concurso.numeros.forEach(num => {
                    frequencia[num] = (frequencia[num] || 0) + 1;
                });
            });
            
            // Encontrar n√∫meros mais e menos sorteados
            const numerosMaisSorteados = Object.entries(frequencia)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([num, freq]) => ({ num: parseInt(num), freq }));
            
            const numerosMenosSorteados = Object.entries(frequencia)
                .sort((a, b) => a[1] - b[1])
                .slice(0, 5)
                .map(([num, freq]) => ({ num: parseInt(num), freq }));
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h4>üî• N√∫meros Mais Sorteados</h4>
                        <div style="margin-top: 15px;">
                            ${numerosMaisSorteados.map(item => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--accent); 
                                              display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                            ${item.num.toString().padStart(2, '0')}
                                        </div>
                                        <span>N√∫mero ${item.num}</span>
                                    </div>
                                    <div style="color: #ffeb3b; font-weight: bold;">
                                        ${item.freq} vezes
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h4>‚ùÑÔ∏è N√∫meros Menos Sorteados</h4>
                        <div style="margin-top: 15px;">
                            ${numerosMenosSorteados.map(item => `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--info); 
                                              display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                            ${item.num.toString().padStart(2, '0')}
                                        </div>
                                        <span>N√∫mero ${item.num}</span>
                                    </div>
                                    <div style="color: #ffeb3b; font-weight: bold;">
                                        ${item.freq} vezes
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Atualizar estat√≠sticas gerais
        function atualizarEstatisticas() {
            const totalJogos = LotofacilDB.jogos.length;
            const totalConferencias = LotofacilDB.resultados.length;
            
            let totalPremiado = 0;
            let maiorPremio = 0;
            let totalJogosPremiados = 0;
            
            // Calcular distribui√ß√£o de acertos
            const distribuicaoAcertos = {};
            
            LotofacilDB.resultados.forEach(r => {
                r.conferencias.forEach(c => {
                    totalPremiado += c.premio;
                    if (c.premio > maiorPremio) maiorPremio = c.premio;
                    if (c.premio > 0) totalJogosPremiados++;
                    
                    // Contabilizar acertos
                    distribuicaoAcertos[c.acertos] = (distribuicaoAcertos[c.acertos] || 0) + 1;
                });
            });
            
            // Atualizar estat√≠sticas gerais
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalJogos}</div>
                    <div class="stat-label">Jogos Gerados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalConferencias}</div>
                    <div class="stat-label">Confer√™ncias</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">R$ ${totalPremiado.toFixed(2)}</div>
                    <div class="stat-label">Total em Pr√™mios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalJogosPremiados}</div>
                    <div class="stat-label">Jogos Premiados</div>
                </div>
            `;
            
            // Atualizar gr√°fico de distribui√ß√£o
            atualizarGraficoAcertos(distribuicaoAcertos);
            
            // Atualizar hist√≥rico
            atualizarHistorico();
        }

        function atualizarGraficoAcertos(distribuicao) {
            const container = document.getElementById('graficoAcertos');
            
            // Ordenar acertos de 11 a 15
            const acertosOrdenados = [11, 12, 13, 14, 15];
            const dados = acertosOrdenados.map(acerto => ({
                acerto,
                quantidade: distribuicao[acerto] || 0
            }));
            
            const total = dados.reduce((sum, item) => sum + item.quantidade, 0);
            
            container.innerHTML = `
                <div style="display: flex; height: 200px; align-items: flex-end; gap: 20px; margin-top: 30px; padding: 0 20px;">
                    ${dados.map(item => {
                        const altura = total > 0 ? (item.quantidade / total) * 100 : 0;
                        const cores = {
                            11: '#2196f3',
                            12: '#9c27b0', 
                            13: '#ff5722',
                            14: '#ff9800',
                            15: '#ffeb3b'
                        };
                        
                        return `
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; height: ${altura}%; 
                                      background: linear-gradient(to top, ${cores[item.acerto]}, ${cores[item.acerto]}80);
                                      border-radius: 10px 10px 0 0; position: relative;">
                                    <div style="position: absolute; top: -25px; left: 0; right: 0; text-align: center; 
                                          color: white; font-weight: bold;">
                                        ${item.quantidade}
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-weight: bold; color: ${cores[item.acerto]}">
                                    ${item.acertos} acertos
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function atualizarHistorico() {
            const tabela = document.getElementById('historicoTable');
            
            if (LotofacilDB.resultados.length === 0) {
                tabela.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #ccc;">
                            Nenhuma confer√™ncia realizada ainda.
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Mostrar √∫ltimas 15 confer√™ncias
            const ultimosResultados = LotofacilDB.resultados.slice(-15).reverse();
            
            tabela.innerHTML = ultimosResultados.map(r => {
                const totalPremio = r.conferencias.reduce((sum, c) => sum + c.premio, 0);
                const jogosPremiados = r.conferencias.filter(c => c.premio > 0).length;
                const origem = r.origem === 'api' ? 'üåê Auto' : '‚úçÔ∏è Manual';
                
                return `
                    <tr>
                        <td><strong>${r.concurso}</strong></td>
                        <td>${new Date(r.data).toLocaleDateString('pt-BR')}</td>
                        <td>
                            <span class="acertos-badge" style="background: ${totalPremio > 0 ? '#4caf50' : '#2196f3'}">
                                ${jogosPremiados}/${r.conferencias.length}
                            </span>
                        </td>
                        <td style="color: ${totalPremio > 0 ? '#4caf50' : '#ccc'}; font-weight: ${totalPremio > 0 ? 'bold' : 'normal'};">
                            R$ ${totalPremio.toFixed(2)}
                        </td>
                        <td>
                            <button onclick="verDetalhesConferencia(${r.id})" 
                                    style="padding: 5px 10px; font-size: 12px;">
                                üîç Detalhes
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Fun√ß√£o para ver detalhes de confer√™ncia
        window.verDetalhesConferencia = function(resultadoId) {
            const resultado = LotofacilDB.resultados.find(r => r.id === resultadoId);
            if (!resultado) return;
            
            // Mudar para aba manual e preencher dados
            document.querySelector('.tab-btn[data-tab="conferir-manual"]').click();
            
            document.getElementById('concursoManual').value = resultado.concurso;
            document.getElementById('dataManual').value = resultado.data.split('T')[0];
            document.getElementById('numerosManual').value = resultado.numerosSorteados.join(', ');
            
            // Executar confer√™ncia
            setTimeout(() => {
                conferirManual();
            }, 500);
        };

        // Sistema de notifica√ß√µes
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Carregar dados iniciais
        function init() {
            // Carregar jogos salvos
            const gamesContainer = document.getElementById('gamesContainer');
            const noGames = document.getElementById('noGames');
            
            if (LotofacilDB.jogos.length > 0) {
                noGames.style.display = 'none';
                LotofacilDB.jogos.forEach((jogo, index) => {
                    displayGame(jogo, index + 1);
                });
            } else {
                noGames.style.display = 'block';
            }
            
            // Configurar datas padr√£o
            const hoje = new Date();
            const umaSemanaAtras = new Date(hoje);
            umaSemanaAtras.setDate(hoje.getDate() - 7);
            
            document.getElementById('dataManual').value = hoje.toISOString().split('T')[0];
            document.getElementById('dataInicio').value = umaSemanaAtras.toISOString().split('T')[0];
            document.getElementById('dataFim').value = hoje.toISOString().split('T')[0];
            
            // Configurar exemplo de n√∫meros sorteados
            document.getElementById('numerosManual').value = '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15';
            
            // Atualizar estat√≠sticas
            atualizarEstatisticas();
            
            // Testar conex√£o com API
            testarConexaoAPI();
        }

        async function testarConexaoAPI() {
            try {
                const response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                
                console.log('API da Caixa est√° acess√≠vel');
            } catch (error) {
                console.log('Usando fallback para API da Caixa');
            }
        }

        // Bot√£o para atualizar √∫ltimos sorteios
        document.getElementById('atualizarSorteiosBtn').addEventListener('click', carregarUltimosSorteios);
        document.getElementById('qtdConcursosSorteios').addEventListener('change', carregarUltimosSorteios);
        document.getElementById('tipoExibicao').addEventListener('change', carregarUltimosSorteios);

        // Inicializar quando a p√°gina carregar
        window.addEventListener('load', init);
    </script>
</body>
</html>